<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KPI Pro BR - Learning Focused on the Brazilian Market</title>
    <!-- Load Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Font */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
        }
        /* Custom styles for line clamping on the cards */
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Header -->
    <header id="app-header" class="bg-green-700 shadow-xl p-4 sticky top-0 z-10">
        <div class="container mx-auto flex justify-between items-center">
            <h1 id="home-link-header" class="text-2xl font-extrabold text-white tracking-widest cursor-pointer hover:text-yellow-300 transition duration-300">
                KPI Pro BR <span class="text-yellow-300">üáßüá∑</span>
            </h1>
            <nav class="space-x-4">
                <button id="home-link-nav" class="text-white font-medium hover:text-yellow-300 transition duration-300 focus:outline-none">
                    Home / Lessons
                </button>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main id="app-content" class="container mx-auto flex-grow p-4 sm:p-6 lg:p-8">
        <!-- Content will be injected here by JavaScript -->
        <div class="text-center p-12 text-gray-500">Loading application...</div>
    </main>

    <!-- Footer -->
    <footer class="bg-blue-800 p-4 mt-12">
        <div class="container mx-auto text-center text-white text-sm">
            (2025 @ Daby)
        </div>
    </footer>

    <script>
        // --- 1. DATA STRUCTURES (Recreated from React) ---

        const lessons = [
            {
                id: 1,
                role: 'Sales Analyst',
                level: 'J√∫nior',
                title: 'Volume and Productivity KPIs',
                description: 'Focus on direct effort and sales result metrics, essential for beginners in an SP Call Center.',
                kpis: [
                    { name: 'Number of Calls Made', description: 'Daily contact volume to ensure minimum effort.' },
                    { name: 'Conversion Rate (Lead-to-Sale)', description: 'The effectiveness in closing deals, measuring pitch quality.' },
                    { name: 'Average Ticket Size', description: 'The average value of each sale made.' },
                ],
                scenario: {
                    title: 'The Week of Goals at the SP Call Center',
                    steps: [
                        { id: 1, title: 'The Analyst\'s Challenge', content: 'Jo√£o, a Junior Analyst in S√£o Paulo, has a target of 100 calls and 5% Conversion. He needs to balance effort (volume) and quality (conversion).', imageAlt: 'Young person in front of a computer with headphones' },
                        { id: 2, title: 'Effort KPI in Action', content: 'By making only 15 calls/day, he fails the Effort KPI. He must use work time more efficiently.', imageAlt: 'Bar chart of call volume' },
                        { id: 3, title: 'Quality Adjustment (Conversion)', content: 'After focusing on calls, he achieves volume, but conversion drops to 3%. The manager advises focusing on active listening and customer problem-solving to meet the 5% target.', imageAlt: 'Sales funnel chart' },
                        { id: 4, title: 'Result and Lesson', content: 'By improving pitch quality, Jo√£o reaches 6% conversion, exceeding the target. He learns that the conversion KPI is more valuable than the volume KPI.', imageAlt: 'Person celebrating success' },
                    ],
                },
                exercise: [
                    {
                        id: 1,
                        text: "What is the main focus of a Junior Sales Analyst's KPIs, compared to a Manager's?",
                        options: ["Long-term financial results", "Effort metrics and direct output (activities)", "Marketing budget allocation", "Strategic customer retention"],
                        correctAnswerIndex: 1,
                        explanation: "The difference in KPI focus is determined by the **level of control and strategic impact**. Staff (Junior/Pleno) performance is measured by **Operational KPIs**‚Äîmetrics they can directly influence day-to-day, like call volume or conversion rate. Managers and Executives focus on **Strategic KPIs** (like ROI or long-term growth) that measure overall business health and goal alignment.",
                    },
                ],
            },
            {
                id: 2,
                role: 'Marketing Coordinator',
                level: 'Gerente',
                title: 'Strategic and Return (ROI) KPIs',
                description: 'Focus on budget management and the financial impact of product launch campaigns in the Northeast. **The figures do not lie!**',
                kpis: [
                    { name: 'Customer Acquisition Cost (CAC)', description: 'The average cost of acquiring a new customer (should be lower than LTV).' },
                    { name: 'Return on Investment (ROI)', description: 'The real financial impact of the campaign.' },
                ],
                scenario: {
                    title: 'Product Launch in the Northeast',
                    steps: [
                        { id: 1, title: 'Regional Planning', content: 'Maria, a Coordinator in Recife, has a R$ 50,000.00 budget and a maximum CAC target of R$ 50.00 for an app launch in the region.', imageAlt: 'Map of Northeast Brazil with markers' },
                        { id: 2, title: 'CAC Monitoring', content: 'The initial campaign has a CAC of R$ 60.00. **Action:** Maria decides to pause lower-performing media (Radio) and reallocate the budget to digital channels with better conversion (Instagram Ads).', imageAlt: 'Customer Acquisition Cost calculation' },
                        { id: 3, title: 'Strategic ROI Analysis', content: 'In the end, the 200% ROI justifies the investment. The CAC KPI is important, but ROI (Profitability) is the definitive metric for a manager.', imageAlt: 'Return on Investment chart' },
                    ],
                },
                exercise: [
                    {
                        id: 1,
                        text: "Which marketing KPI is considered the most strategic by a Manager?",
                        options: ["Page Views", "Post Likes", "Cost Per Click (CPC)", "Return on Investment (ROI)"],
                        correctAnswerIndex: 3,
                        explanation: "As a **Strategic KPI**, ROI measures the ultimate financial return, directly connecting campaign spending to profit. Managers prioritize ROI because it justifies investment and measures the business impact, unlike activity metrics (CPC, Views) which only track effort.",
                    },
                ],
            },
            {
                id: 3,
                role: 'HR Manager',
                level: 'S√™nior',
                title: 'Retention and Engagement KPIs',
                description: 'Focus on retaining talent and ensuring a productive environment at the Minas Gerais branch.',
                kpis: [
                    { name: 'Voluntary Turnover Rate', description: 'Percentage of employees who voluntarily leave the company.' },
                    { name: 'eNPS (Employee Net Promoter Score)', description: 'Measures employee engagement and the likelihood of an employee recommending the company.' },
                ],
                scenario: {
                    title: 'Staff Turnover Crisis at the Minas Gerais Branch',
                    steps: [
                        { id: 1, title: 'The Turnover Alert', content: 'Mariana, an HR Manager in Belo Horizonte, observes that the **Voluntary Turnover Rate** has risen from 5% to 15% in 6 months, a sign of a retention crisis.', imageAlt: 'Alarm clock symbol' },
                        { id: 2, title: 'The eNPS Cause', content: 'An **eNPS** survey reveals the score dropped 30 points, indicating low satisfaction. Detractors cite a lack of career plan and feedback.', imageAlt: 'eNPS chart with a sharp drop' },
                        { id: 3, title: 'Action and Career Plan', content: 'Mariana implements a new development and mentorship program. In 3 months, the eNPS rises 10 points, and Turnover begins to slow down, showing that the KPIs are connected.', imageAlt: 'People in a mentorship meeting' },
                    ],
                },
                exercise: [
                    {
                        id: 1,
                        text: "What does a low eNPS in an organizational climate survey usually indicate?",
                        options: ["That sales are low", "Problems in product quality", "Low engagement and risk of increased turnover", "Need to reduce Customer Acquisition Cost (CAC)"],
                        correctAnswerIndex: 2,
                        explanation: "eNPS is a measure of employee engagement. A low score indicates the team is dissatisfied and prone to leaving the company (high turnover).",
                    },
                ],
            },
        ];

        // --- 2. GLOBAL STATE AND NAVIGATION ---
        const AppState = {
            currentPageId: null, // null for Home, ID for Lesson Detail
            scenarioSteps: {} // Stores the current step for each lesson ID
        };

        const appContent = document.getElementById('app-content');

        /**
         * Renders the entire application based on the current state.
         * @param {number|null} id - The ID of the lesson to navigate to, or null for home.
         */
        const navigateTo = (id) => {
            AppState.currentPageId = id;
            window.scrollTo(0, 0);

            if (id === null) {
                renderHome();
            } else {
                const lesson = lessons.find(l => l.id === id);
                if (lesson) {
                    renderLessonDetail(lesson);
                } else {
                    appContent.innerHTML = `<div class="text-center p-12 text-red-500 text-xl">Lesson not found.</div>`;
                }
            }
        };

        // --- 3. RENDERING FUNCTIONS ---

        /**
         * Renders the Home View (list of lessons).
         */
        const renderHome = () => {
            const lessonCards = lessons.map(lesson => {
                let levelClasses = '';
                if (lesson.level === 'Gerente') {
                    levelClasses = 'bg-red-100 text-red-800';
                } else if (lesson.level === 'S√™nior') {
                    levelClasses = 'bg-orange-100 text-orange-800';
                } else {
                    levelClasses = 'bg-blue-100 text-blue-800';
                }

                return `
                    <div data-id="${lesson.id}" class="bg-white p-6 rounded-xl shadow-lg hover:shadow-xl transition duration-300 transform hover:-translate-y-1 border-t-4 border-green-500 cursor-pointer lesson-card">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="text-xl font-bold text-gray-900">${lesson.role}</h3>
                            <span class="px-3 py-1 text-xs font-semibold rounded-full shadow-sm ${levelClasses}">
                                ${lesson.level}
                            </span>
                        </div>
                        <h4 class="text-lg font-medium text-green-600 mb-3">${lesson.title}</h4>
                        <p class="text-sm text-gray-600 mb-4 line-clamp-3">${lesson.description}</p>
                        <div class="text-xs font-semibold text-blue-600 flex items-center">
                            View Full Lesson &rarr;
                        </div>
                    </div>
                `;
            }).join('');

            appContent.innerHTML = `
                <div class="space-y-8">
                    <header class="text-center py-8 bg-blue-100 rounded-xl shadow-md">
                        <h2 class="text-4xl font-black text-blue-800 mb-2">
                            Learning KPIs in Practice
                        </h2>
                        <p class="text-xl text-gray-600">
                            Select a role and level to start your practical training with real-world scenarios.
                        </p>
                    </header>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${lessonCards}
                    </div>
                </div>
            `;

            // Attach event listeners to the new cards
            document.querySelectorAll('.lesson-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    const id = parseInt(card.getAttribute('data-id'));
                    navigateTo(id);
                });
            });
        };

        /**
         * Renders the Lesson Detail View.
         * @param {object} lesson
         */
        const renderLessonDetail = (lesson) => {
            const kpiList = lesson.kpis.map((kpi, index) => `
                <div key="${index}" class="p-4 border border-gray-100 rounded-lg bg-gray-50">
                    <p class="font-semibold text-lg text-gray-900 flex items-center">
                        <span class="text-yellow-500 mr-2 text-2xl">‚òÖ</span> ${kpi.name}
                    </p>
                    <p class="text-sm text-gray-600 mt-1">${kpi.description}</p>
                </div>
            `).join('');

            appContent.innerHTML = `
                <div class="space-y-10">
                    <button id="back-to-list-btn" class="text-blue-600 hover:text-blue-800 transition duration-200 flex items-center mb-6">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg>
                        Back to Lesson List
                    </button>
                    
                    <header class="text-center py-6 bg-green-600 text-white rounded-xl shadow-lg">
                        <p class="text-sm font-light uppercase opacity-80">${lesson.role} | Level ${lesson.level}</p>
                        <h2 class="text-3xl font-black mt-1 mb-2">${lesson.title}</h2>
                        <p class="text-lg font-medium opacity-90 mx-auto max-w-3xl">
                            ${lesson.description}
                        </p>
                    </header>

                    <!-- Section 1: Key KPIs -->
                    <div class="bg-white p-6 rounded-xl shadow-xl border-t-4 border-blue-500">
                        <h3 class="text-2xl font-bold text-blue-700 mb-4">Key Performance Indicators (KPIs)</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${kpiList}
                        </div>
                    </div>

                    <!-- Section 2: Scenario Walkthrough -->
                    <div id="scenario-container"></div>

                    <!-- Section 3: Interactive Exercise -->
                    <div id="exercise-container"></div>
                </div>
            `;

            document.getElementById('back-to-list-btn').addEventListener('click', () => navigateTo(null));

            renderScenarioStepper(lesson);
            renderExercise(lesson);
        };

        /**
         * Renders the Scenario Stepper component.
         * @param {object} lesson
         */
        const renderScenarioStepper = (lesson) => {
            const container = document.getElementById('scenario-container');
            const lessonId = lesson.id;
            
            // Initialize current step for the lesson if not exists
            if (AppState.scenarioSteps[lessonId] === undefined) {
                AppState.scenarioSteps[lessonId] = 0;
            }
            let currentStep = AppState.scenarioSteps[lessonId];
            const totalSteps = lesson.scenario.steps.length;
            const currentStepData = lesson.scenario.steps[currentStep];
            const progress = ((currentStep + 1) / totalSteps) * 100;

            container.innerHTML = `
                <div class="bg-white p-6 rounded-xl shadow-xl border border-gray-200">
                    <h3 class="text-2xl font-bold mb-4 text-blue-700">Scenario: ${lesson.scenario.title}</h3>
                    <p class="text-sm text-gray-500 italic mb-4">Real-World Case Walkthrough in Brazil.</p>
                    
                    <!-- Progress Bar -->
                    <div class="mb-6">
                        <div class="h-2 bg-gray-200 rounded-full">
                            <div 
                                class="h-2 bg-yellow-500 rounded-full transition-all duration-500"
                                style="width: ${progress}%"
                            ></div>
                        </div>
                        <p class="text-right text-sm text-gray-600 mt-1">Step ${currentStep + 1} of ${totalSteps}</p>
                    </div>
                    
                    <!-- Step Content -->
                    <div class="p-4 bg-green-50 border-l-4 border-green-500 rounded-lg mb-6">
                        <h4 class="text-xl font-bold mb-3 text-green-700">${currentStepData.title}</h4>
                        <p class="text-gray-700 whitespace-pre-line leading-relaxed">${currentStepData.content}</p>
                    </div>
                    
                    <!-- Navigation Buttons -->
                    <div class="flex justify-between">
                        <button id="prev-step-btn" 
                            class="px-4 py-2 rounded-full font-medium transition duration-300 shadow-md text-sm
                            ${currentStep === 0 ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-blue-600 text-white hover:bg-blue-700'}"
                            ${currentStep === 0 ? 'disabled' : ''}>
                            &larr; Previous
                        </button>
                        <button id="next-step-btn" 
                            class="px-4 py-2 rounded-full font-medium transition duration-300 shadow-md text-sm
                            ${currentStep === totalSteps - 1 ? 'bg-gray-300 text-gray-500 cursor-not-allowed' : 'bg-green-600 text-white hover:bg-green-700'}"
                            ${currentStep === totalSteps - 1 ? 'disabled' : ''}>
                            ${currentStep === totalSteps - 1 ? 'Scenario Complete!' : 'Next Step \u2192'}
                        </button>
                    </div>
                </div>
            `;

            // Attach event listeners
            document.getElementById('prev-step-btn').addEventListener('click', () => {
                AppState.scenarioSteps[lessonId] = Math.max(currentStep - 1, 0);
                renderScenarioStepper(lesson);
            });
            document.getElementById('next-step-btn').addEventListener('click', () => {
                AppState.scenarioSteps[lessonId] = Math.min(currentStep + 1, totalSteps - 1);
                renderScenarioStepper(lesson);
            });
        };


        /**
         * Renders the Interactive Exercise component.
         * @param {object} lesson
         */
        const renderExercise = (lesson) => {
            const container = document.getElementById('exercise-container');
            const lessonId = lesson.id;
            const questions = lesson.exercise;

            // Initialize exercise state for the lesson if not exists
            if (!AppState.exerciseState) AppState.exerciseState = {};
            if (!AppState.exerciseState[lessonId]) {
                AppState.exerciseState[lessonId] = {
                    selectedAnswers: Array(questions.length).fill(null),
                    submitted: false
                };
            }

            let state = AppState.exerciseState[lessonId];
            const score = questions.filter((q, i) => state.selectedAnswers[i] === q.correctAnswerIndex).length;
            const isComplete = state.selectedAnswers.every(a => a !== null);
            
            const handleSelect = (qIndex, aIndex) => {
                if (state.submitted) return;
                state.selectedAnswers[qIndex] = aIndex;
                renderExercise(lesson); // Re-render to show selection
            };

            const handleSubmit = () => {
                state.submitted = true;
                renderExercise(lesson); // Re-render to show results
                document.getElementById('exercise-results')?.scrollIntoView({ behavior: 'smooth' });
            };

            const handleReset = () => {
                state.submitted = false;
                state.selectedAnswers = Array(questions.length).fill(null);
                renderExercise(lesson); // Re-render to reset quiz
            };

            const scoreDisplay = state.submitted ? `
                <div id="exercise-results" class="p-4 mb-6 bg-blue-100 border-l-4 border-blue-500 text-blue-700 font-bold text-lg rounded-md">
                    Your Result: ${score} out of ${questions.length} (${((score / questions.length) * 100).toFixed(0)}%)
                </div>
            ` : '';

            const questionMarkup = questions.map((q, qIndex) => {
                const optionsMarkup = q.options.map((option, aIndex) => {
                    let optionClasses = '';
                    let prefix = '';
                    const isSelected = state.selectedAnswers[qIndex] === aIndex;
                    const isCorrect = q.correctAnswerIndex === aIndex;
                    
                    if (!state.submitted) {
                        // Not submitted: show hover/selected state
                        optionClasses = isSelected ? 'bg-blue-200 border-blue-500 cursor-pointer' : 'hover:bg-gray-50 cursor-pointer';
                    } else {
                        // Submitted: show result state
                        if (isCorrect) {
                            optionClasses = 'bg-green-100 border-green-500 font-bold';
                            prefix = '‚úÖ ';
                        } else if (isSelected) {
                            optionClasses = 'bg-red-100 border-red-500 font-bold opacity-70';
                            prefix = '‚ùå ';
                        } else {
                            optionClasses = 'bg-gray-100 opacity-50';
                        }
                    }

                    return `
                        <div 
                            class="p-3 border rounded-lg transition duration-200 text-sm option-select ${optionClasses}"
                            data-qindex="${qIndex}" 
                            data-aindex="${aIndex}"
                            ${state.submitted ? 'style="pointer-events: none;"' : ''}
                        >
                            ${prefix}${option}
                        </div>
                    `;
                }).join('');

                const explanationMarkup = state.submitted ? `
                    <div class="mt-3 text-sm p-3 bg-gray-50 border-l-2 border-gray-300 rounded-br-lg rounded-bl-lg">
                        <p class="font-bold text-green-700">Explanation:</p>
                        <p class="text-gray-600">${q.explanation}</p>
                    </div>
                ` : '';

                return `
                    <div class="mb-8 p-4 border border-gray-200 rounded-lg bg-white shadow-sm">
                        <p class="font-semibold mb-3 text-lg text-gray-800">
                            ${qIndex + 1}. ${q.text}
                        </p>
                        <div class="space-y-2">
                            ${optionsMarkup}
                        </div>
                        ${explanationMarkup}
                    </div>
                `;
            }).join('');
            
            const buttonMarkup = !state.submitted ? `
                <button
                    id="submit-quiz-btn"
                    class="w-full bg-red-600 text-white font-bold py-3 rounded-lg hover:bg-red-700 transition duration-300 ${!isComplete ? 'disabled:bg-gray-400 disabled:cursor-not-allowed' : 'shadow-md'}"
                    ${!isComplete ? 'disabled' : ''}
                >
                    Check Answers
                </button>
            ` : `
                <button
                    id="reset-quiz-btn"
                    class="w-full bg-blue-600 text-white font-bold py-3 rounded-lg hover:bg-blue-700 transition duration-300 shadow-md"
                >
                    Try Again
                </button>
            `;


            container.innerHTML = `
                <div class="mt-8 p-6 bg-yellow-50 rounded-xl shadow-lg border-t-4 border-yellow-500">
                    <h3 class="text-3xl font-extrabold text-red-600 mb-6 border-b pb-2">
                        Interactive Exercise üí°
                    </h3>
                    ${scoreDisplay}
                    ${questionMarkup}
                    ${buttonMarkup}
                </div>
            `;

            // Attach event listeners for selection
            document.querySelectorAll('.option-select').forEach(optionDiv => {
                optionDiv.addEventListener('click', (e) => {
                    const qIndex = parseInt(optionDiv.getAttribute('data-qindex'));
                    const aIndex = parseInt(optionDiv.getAttribute('data-aindex'));
                    handleSelect(qIndex, aIndex);
                });
            });

            // Attach event listeners for submit/reset
            if (document.getElementById('submit-quiz-btn')) {
                document.getElementById('submit-quiz-btn').addEventListener('click', handleSubmit);
            }
            if (document.getElementById('reset-quiz-btn')) {
                document.getElementById('reset-quiz-btn').addEventListener('click', handleReset);
            }
        };


        // --- 4. INITIALIZATION ---

        window.onload = () => {
            // Set up universal navigation listeners
            document.getElementById('home-link-header').addEventListener('click', () => navigateTo(null));
            document.getElementById('home-link-nav').addEventListener('click', () => navigateTo(null));
            
            // Start the application on the home view
            navigateTo(null);
        };
    </script>
</body>
</html>
